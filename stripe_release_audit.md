# Stripeサブスクリプション正式リリース前チェック（規約/FAQ/チャージバック懸念の洗い出し）

作成日: 2025-12-16

> 注意: これは法的助言ではなく、現状コード/画面文言から読み取れる仕様と、サブスク運用で一般に問題になりやすい点を「洗い出し」した技術・運用メモです。正式リリース前に弁護士/専門家レビューを推奨します。

## 0. 目的

Stripeでサブスクリプションを「正式リリース」する前に、

1) 利用規約/プライバシーポリシー/特商法表示 等の不足
2) 画面の「よくある質問」と現仕様の不整合
3) チャージバック（返金要求/異議申し立て/不正利用/支払い失敗）への備え不足

を洗い出し、対応の優先順位付けをしやすくする。

---

## 1. 現状仕様（リポジトリから読み取れる範囲）

### 1.1 プランと利用回数

- 画面（`frontend/src/pages/PricingPage.tsx`）
  - Free: ブログ4コマ 5回/日、動画4コマ 3回/日（デモ透かし）
  - Lite: 480円/月、月30回（ブログ・動画共通）
  - Pro: 980円/月、月100回（ブログ・動画共通）
- 生成API（`functions/api/generate-4koma.ts`, `functions/api/generate-movie-4koma.ts`）
  - demo: 日次制限（KVでIP+日付）
  - lite/pro: 月次制限（D1 `usage` を当月集計）
  - byok: ユーザーのGemini APIキーで生成（回数制限なし）

### 1.2 Stripeフロー

- Checkout（`functions/api/checkout.ts`）
  - Stripe Customerを作成/再利用して Checkout Session を作成
  - metadata に `user_id`, `plan` を付与
- Webhook（`functions/api/webhook.ts`）
  - `checkout.session.completed` で `users.plan` と `stripe_subscription_id` を更新
  - `customer.subscription.updated` で `active` / `canceled|unpaid|past_due` に応じて plan を更新
  - `customer.subscription.deleted` で plan を free に戻す
- Portal（`functions/api/portal.ts`）
  - Stripe Billing Portal セッションを作成してユーザーに返す

### 1.3 利用規約/プライバシーポリシー現状

- `TERMS.md` は「サービス利用自体は無料」「Gemini API料金はユーザー課金」前提の内容が中心。
- Stripe課金、解約/返金、支払い失敗、不正利用、領収書/税、特商法表示等は未記載。
- DBに email/plan/stripe_customer_id を保存する実装があるが、`TERMS.md` のプライバシーポリシーには明確な記載が不足。

---

## 2. 重大な不整合（このまま正式リリースすると揉めやすい）

### 2.1 「無料」と「サブスク課金」の矛盾

- `TERMS.md`:
  - 「本サービスの利用自体は無料」
  - 「Gemini APIの利用料金はユーザー自身のGoogleアカウントに請求」
- 実装/画面:
  - Lite/Pro は Stripe で月額課金
  - Lite/Pro はサーバ側APIキーで生成（ユーザーのGoogle課金ではない）

**懸念**

- 誤認/誤解による返金要求・カード会社への申し立て（"無料と思った"）の温床。

### 2.2 データ取り扱いの齟齬（保存しない vs 保存している）

- `TERMS.md` プライバシーポリシー:
  - 「記事データは処理完了後に破棄」
  - 「アクセスログはCloudflare標準ログとして記録される場合」
- 実装:
  - URLログをKVに保存（`URL_LOGS`）
  - 利用回数をD1 `usage` に保存（`user_id`, `type`）
  - サブスクユーザー情報をD1 `users` に保存（email/plan/stripe ids）

**懸念**

- 個人情報/準個人情報（email、IP、入力URL等）の扱いが曖昧で、問い合わせ/削除要求/監査で詰まりやすい。
- チャージバック時の証跡方針（何を保持し、どの期間で消すか）が不明。

---

## 3. 利用規約（Terms）で不足している可能性が高い項目

`TERMS.md` を「サブスク前提」に作り直す/分割する際の観点。

### 3.1 料金/課金/更新

- 自動更新（サブスクリプション）であること
- 請求タイミング（初回課金日・更新日）
- プラン内容（回数/月、対象機能、上限到達時の挙動）
- 価格表示の税区分（内税/外税、消費税、海外ユーザー等）
- 価格改定の手順（告知期間・既存契約への適用）

### 3.2 解約/返金/キャンセル

- 解約方法（Stripe Portal/サイト内導線）
- 解約の効力（即時停止か、次回更新まで利用可か）
- 返金ポリシー（原則不可/条件付き/日割り可否）
- 誤課金・二重課金・不正利用疑いの受付方法
- 返金・クレジット・請求取消の取り扱い

### 3.3 支払い失敗・不払い

- 支払い失敗時の機能制限（いつfreeへ戻るか、猶予期間）
- 支払い遅延・再請求・通知

### 3.4 アカウント/認証

- 認証方式（Cloudflare Access 等）と、ログインできない場合の扱い
- アカウント停止/解除（不正利用、規約違反、支払い不履行等）

### 3.5 生成コンテンツ/著作権/禁止事項（強化推奨）

- 生成物の権利帰属・商用利用可否（"ユーザーに帰属" の条件/例外）
- 入力素材（URL先の著作物、YouTube等）の権利侵害リスクの責任分界
- 禁止事項（リクエストの大量送信、スクレイピング、第三者の権利侵害、違法・有害コンテンツ等）
- 生成結果の品質保証なし（正確性・完全性）

### 3.6 免責/責任制限（運用上の明確化）

- サービス中断/停止、外部API停止（Google/Stripe/Cloudflare）時の免責
- 損害賠償の上限（一般に条項がないと揉めやすい）

### 3.7 準拠法・裁判管轄・連絡先

- 準拠法、合意管轄
- 問い合わせ窓口（現状はGitHub Issueだが、課金サービスではメール等の用意が望ましい）

---

## 4. プライバシーポリシーで不足している可能性が高い項目

### 4.1 収集・保存・目的

- 収集する情報の追加
  - email（ユーザー識別）
  - Stripe customer/subscription id（課金管理）
  - 利用回数ログ（usage）
  - 入力URLログ（URL_LOGS）
- 保存期間（TTLなし/無期限のものがあるなら明記と最小化方針）
- 利用目的（課金、利用回数管理、不正対策、サポート等）

### 4.2 第三者提供/委託

- Stripe（決済）
- Cloudflare（ホスティング/ログ）
- Google Gemini API（生成）
- noembed.com（動画メタ情報取得に利用している場合）

### 4.3 依頼対応

- 開示/訂正/削除の受付方法
- 退会/削除時に消えるデータ・残るデータ（会計・不正対策・法令対応など）

---

## 5. 「よくある質問（FAQ）」の不整合/不足

現状のFAQ（`PricingPage.tsx`）:

- 「いつでも解約できますか？ → 次の請求日まで利用できます」
- 「プラン変更できる」
- 「回数カウント」

### 5.1 不整合になり得るポイント

- "次の請求日まで利用できます" は、Stripe Portalの設定（cancel at period end）次第で変わる
- "いつでもダウングレード可能" は、
  - いつ反映されるのか（即時/次回更新/日割り）
  - 既に使った回数の扱い
  - 返金の有無
 などが説明されていない

### 5.2 正式リリース向けにFAQへ追加したい項目案

- 請求に関するもの
  - いつ課金されますか？（初回/更新）
  - 領収書/請求書はどこから入手できますか？（Stripeのレシート等）
  - 料金に税は含まれますか？
- 解約/返金
  - 解約するといつまで使えますか？
  - 返金はできますか？（例外条件）
- 利用回数
  - 月間回数はいつリセットされますか？（請求日基準か月初基準か）
  - 上限に達したらどうなりますか？（翌月まで待つ/上位プラン誘導）
- サポート
  - サポート窓口はどこですか？（メール等）
  - 返信目安（"優先サポート" の具体）
- セキュリティ/プライバシー
  - 入力したURL/プロンプトは保存しますか？
  - BYOK（自分のAPIキー）とサブスクの違いは？
- 不具合時
  - 生成に失敗した場合、回数は消費されますか？

---

## 6. チャージバック/返金トラブルに備えるための懸念点と対応案

### 6.1 チャージバックで典型的に問われること

- 「何を、いくらで、いつから、どんな条件で提供しているか」
- 「ユーザーが自動更新/解約条件を認識していたか」
- 「ユーザーが実際にサービスを利用した証跡があるか」
- 「問い合わせ窓口があり、合理的に対応したか」

### 6.2 現状の懸念

- 規約が "無料" 前提で、サブスク条件の合意が弱い
- 返金ポリシー、支払い失敗時の扱いが未記載
- "メールサポート" を謳っているが、規約/プライバシーはGitHub Issue導線
- どの証跡を保持するか（ToS同意、決済、利用ログ、IP、UA等）の方針が未確立

### 6.3 対応案（優先度順）

**(A) 画面・導線**

- Checkout前に
  - 価格、課金周期、自动更新、解約方法、返金ポリシーを明確表示
  - 利用規約/プライバシーポリシーへのリンクと同意チェックを必須化

**(B) 規約・ポリシー**

- サブスク条件（更新、解約、返金、支払い失敗）を明文化
- Stripeを決済事業者として明記
- サポート窓口（メール）を明記

**(C) 証跡（dispute evidence）**

- 最低限保持したいもの（例）
  - ユーザーの同意記録（同意日時、同意した文書バージョン）
  - 購入/更新のイベント（Stripe event id、プラン、金額、通貨）
  - 利用実績（生成回数、日時、種別）
  - サポート対応ログ（問い合わせ日時、対応履歴）
- ただし保持期間・最小化・プライバシー方針もセットで設計

**(D) 不正対策**

- 明細記載（statement descriptor）やメール通知の整備
- 利用規約に不正利用時の対応（停止/返金不可等）を明記
- Stripe Radar/3DS等の設定検討

---

## 7. 特商法表示（日本向け）で検討が必要な項目（概要）

日本向けに一般に求められることが多い表示項目（例）:

- 事業者名、所在地、連絡先（電話/メール等）
- 販売価格、追加手数料
- 支払い方法、支払い時期
- サービス提供時期（即時など）
- 解約/返品/返金条件
- 動作環境

※ 本当に必要な項目は提供形態によるため、正式リリース前に確認推奨。

---

## 8. リリース前に「最低限」揃える優先順位（提案）

1) `TERMS.md` をサブスク前提に更新（無料前提の記載を是正）
2) プライバシーポリシーに Stripe/DB保存/ログ保持（URL_LOGS, usage, users）を明記
3) PricingのFAQを現仕様（解約・反映タイミング・返金）に合わせて修正
4) 問い合わせ窓口（メール等）を用意し、規約/サイトに記載
5) チャージバックに備えた「同意ログ」「利用ログ」「サポートログ」の保持方針を決める

---

## 9. このメモの根拠（参照ファイル）

- 利用規約/PP: `TERMS.md`
- 料金ページ/FAQ文言: `frontend/src/pages/PricingPage.tsx`
- Stripe実装: `functions/api/checkout.ts`, `functions/api/portal.ts`, `functions/api/webhook.ts`
- 利用回数: `functions/api/_usage.ts`, `schema.sql`
